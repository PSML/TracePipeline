#!/bin/bash

declare -A ht
declare -i i

hist=$1

if [[ ! -a $hist ]]; then
  echo "USAGE: $0 [hist file]"
  exit 0
fi

# Don't use pipe here to avoid subshell so that
# hash table elements are in main process not a subshell
((i=0))
while read cnt sum; do
  if [[ -n ${ht[$sum]} ]]; then
    echo "ERROR: $i: $sum already defined ... ${ht[$sum]}" > /dev/stderr
  else
    ht[$sum]="$i"
  fi
  ((i++))
done < <(cat $hist)

while read sv sum; do
  if [[ -z "${ht[$sum]}" ]]; then
    echo "ERROR: $sv $sum not in hash table" > /dev/stderr
  else
    echo ${ht[$sum]}
  fi
done
