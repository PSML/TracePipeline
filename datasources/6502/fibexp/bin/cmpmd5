#!/bin/bash

if [ $# -ne 7 ]; then
  echo "USAGE: $0 [md5sum1] [md5sum2] [md5 file1] [md5 file2] [trace file1] [trace file2] [block]"
  exit 0
fi

sum1=$1
sum2=$2
md51=$3
md52=$4
trace1=$5
trace2=$6
block=$7

svnum1=-1
svnum2=-1
while read svnum sum; do
  if [ $sum = $sum1 ]; then
    svnum1=$svnum
    break
  fi
done < <(cat $md51 | sort -k2,2 | uniq -f1)
if [ $svnum1 -eq -1 ]; then
  echo "ERROR: $sum1 not found in $md51"
  exit 0
fi

while read svnum sum; do
  if [ $sum = $sum2 ]; then 
    svnum2=$svnum
    break
  fi
done < <(cat $md52 | sort -k2,2 | uniq -f1)
if [ $svnum2 -eq -1 ]; then
  echo "ERROR: $sum2 not found in $md52"
  exit 0
fi

dd if=$trace1 of=$sum1 bs=$block skip=$svnum1 count=1 2> /dev/null
dd if=$trace2 of=$sum2 bs=$block skip=$svnum2 count=1 2> /dev/null

~/6502/fibexp/bin/cmp6502sv $sum1 $sum2

rm -rf $sum1 $sum2
